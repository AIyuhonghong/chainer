

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Caffe Reference Model Support &mdash; Chainer 2.0.0b1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/modified_theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Chainer 2.0.0b1 documentation" href="../index.html"/>
        <link rel="up" title="Chainer Reference Manual" href="index.html"/>
        <link rel="next" title="Visualization of Computational Graph" href="graph.html"/>
        <link rel="prev" title="Trainer triggers" href="triggers.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Chainer
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0b1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Chainer Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Chainer Reference Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core.html">Core functionalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="check.html">Assertion and Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="functions.html">Standard Function implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="links.html">Standard Link implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimizers.html">Optimizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="serializers.html">Serializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="function_hooks.html">Function hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="initializers.html">Weight Initializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Dataset examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="iterators.html">Iterator examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="extensions.html">Trainer extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="triggers.html">Trainer triggers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Caffe Reference Model Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph.html">Visualization of Computational Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment.html">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Chainer Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compatibility.html">API Compatibility Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../comparison.html">Comparison with Other Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chainer</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Chainer Reference Manual</a> &raquo;</li>
        
      <li>Caffe Reference Model Support</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/caffe.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-chainer.links.caffe">
<span id="caffe-reference-model-support"></span><h1>Caffe Reference Model Support<a class="headerlink" href="#module-chainer.links.caffe" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://caffe.berkeleyvision.org/">Caffe</a> is a popular framework maintained by <a class="reference external" href="http://bvlc.eecs.berkeley.edu/">BVLC</a> at UC Berkeley.
It is widely used by computer vision communities, and aims at fast computation and easy usage without any programming.
The BVLC team provides trained reference models in their <a class="reference external" href="http://caffe.berkeleyvision.org/model_zoo.html">Model Zoo</a>, one of the reason why this framework gets popular.</p>
<p>Chainer can import the reference models and emulate the network by <a class="reference internal" href="core/link.html#chainer.Link" title="chainer.Link"><code class="xref py py-class docutils literal"><span class="pre">Link</span></code></a> implementations.
This functionality is provided by the <a class="reference internal" href="#chainer.links.caffe.CaffeFunction" title="chainer.links.caffe.CaffeFunction"><code class="xref py py-class docutils literal"><span class="pre">chainer.links.caffe.CaffeFunction</span></code></a> class.</p>
<dl class="class">
<dt id="chainer.links.caffe.CaffeFunction">
<em class="property">class </em><code class="descclassname">chainer.links.caffe.</code><code class="descname">CaffeFunction</code><span class="sig-paren">(</span><em>model_path</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/links/caffe/caffe_function.html#CaffeFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.links.caffe.CaffeFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Caffe emulator based on the model file of Caffe.</p>
<p>Given a protocol buffers file of a Caffe model, this class loads and
emulates it on <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> objects. It supports the official
reference models provided by BVLC.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">protobuf&gt;=3.0.0 is required if you use Python 3 because protobuf 2 is
not supported on Python 3.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>CaffeFunction ignores the following layers:</p>
<ul class="last simple">
<li>Layers that CaffeFunction does not support (including data layers)</li>
<li>Layers that have no top blobs</li>
<li>Layers whose bottom blobs are incomplete (i.e., some or all of them
are not given nor computed)</li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It does not support full compatibility against Caffe. Some layers and
configurations are not implemented in Chainer yet, though the reference
models provided by the BVLC team are supported except data layers.</p>
</div>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>Consider we want to extract the (unnormalized) log class probability
of given images using BVLC reference CaffeNet. The model can be
downloaded from:</p>
<p><a class="reference external" href="http://dl.caffe.berkeleyvision.org/bvlc_reference_caffenet.caffemodel">http://dl.caffe.berkeleyvision.org/bvlc_reference_caffenet.caffemodel</a></p>
<p>We want to compute the <code class="docutils literal"><span class="pre">fc8</span></code> blob from the <code class="docutils literal"><span class="pre">data</span></code> blob. It is simply
written as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Load the model</span>
<span class="n">func</span> <span class="o">=</span> <span class="n">CaffeFunction</span><span class="p">(</span><span class="s1">&#39;path/to/bvlc_reference_caffenet.caffemodel&#39;</span><span class="p">)</span>

<span class="c1"># Minibatch of size 10</span>
<span class="n">x_data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">227</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="o">...</span>  <span class="c1"># (Fill the minibatch here)</span>

<span class="c1"># Forward the pre-trained net</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>
<span class="n">y</span><span class="p">,</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">},</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fc8&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p class="last">The result <code class="docutils literal"><span class="pre">y</span></code> contains the Variable corresponding to the <code class="docutils literal"><span class="pre">fc8</span></code>
blob. The computational graph is memorized as a usual forward
computation in Chainer, so we can run backprop through this pre-trained
net.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>model_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – Path to the binary-proto model file of Caffe.</td>
</tr>
<tr class="field-even field"><th class="field-name">Variables:</th><td class="field-body"><strong>forwards</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.6)"><em>dict</em></a>) – A mapping from layer names to corresponding functions.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="graph.html" class="btn btn-neutral float-right" title="Visualization of Computational Graph" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="triggers.html" class="btn btn-neutral" title="Trainer triggers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Preferred Networks, inc. and Preferred Infrastructure, inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.0.0b1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>