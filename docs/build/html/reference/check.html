

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Assertion and Testing &mdash; Chainer 2.0.0b1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/modified_theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Chainer 2.0.0b1 documentation" href="../index.html"/>
        <link rel="up" title="Chainer Reference Manual" href="index.html"/>
        <link rel="next" title="Standard Function implementations" href="functions.html"/>
        <link rel="prev" title="Experimental feature annotation" href="util/experimental.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Chainer
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0b1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Chainer Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Chainer Reference Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core.html">Core functionalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html">Utilities</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Assertion and Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#type-checking-utilities">Type checking utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gradient-checking-utilities">Gradient checking utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#standard-assertions">Standard Assertions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#function-testing-utilities">Function testing utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="functions.html">Standard Function implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="links.html">Standard Link implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimizers.html">Optimizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="serializers.html">Serializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="function_hooks.html">Function hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="initializers.html">Weight Initializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Dataset examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="iterators.html">Iterator examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="extensions.html">Trainer extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="triggers.html">Trainer triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="caffe.html">Caffe Reference Model Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph.html">Visualization of Computational Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment.html">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Chainer Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compatibility.html">API Compatibility Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../comparison.html">Comparison with Other Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chainer</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Chainer Reference Manual</a> &raquo;</li>
        
      <li>Assertion and Testing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/check.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="assertion-and-testing">
<h1>Assertion and Testing<a class="headerlink" href="#assertion-and-testing" title="Permalink to this headline">¶</a></h1>
<p>Chainer provides some facilities to make debugging easy.</p>
<div class="section" id="type-checking-utilities">
<span id="type-check-utils"></span><h2>Type checking utilities<a class="headerlink" href="#type-checking-utilities" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="core/function.html#chainer.Function" title="chainer.Function"><code class="xref py py-class docutils literal"><span class="pre">Function</span></code></a> uses a systematic type checking of the <a class="reference internal" href="#module-chainer.utils.type_check" title="chainer.utils.type_check"><code class="xref py py-mod docutils literal"><span class="pre">chainer.utils.type_check</span></code></a> module.
It enables users to easily find bugs of forward and backward implementations.
You can find examples of type checking in some function implementations.</p>
<span class="target" id="module-chainer.utils.type_check"></span><dl class="class">
<dt id="chainer.utils.type_check.Expr">
<em class="property">class </em><code class="descclassname">chainer.utils.type_check.</code><code class="descname">Expr</code><span class="sig-paren">(</span><em>priority</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/utils/type_check.html#Expr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.utils.type_check.Expr" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract syntax tree of an expression.</p>
<p>It represents an abstract syntax tree, and isn’t a value. You can get its
actual value with <a class="reference internal" href="#chainer.utils.type_check.Expr.eval" title="chainer.utils.type_check.Expr.eval"><code class="xref py py-meth docutils literal"><span class="pre">eval()</span></code></a> function, and get syntax representation with
the <code class="xref py py-meth docutils literal"><span class="pre">__str__()</span></code> method.
Each comparison operator (e.g. <code class="docutils literal"><span class="pre">==</span></code>) generates a new <a class="reference internal" href="#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a> object
which represents the result of comparison between two expressions.</p>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>Let <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> be instances of <a class="reference internal" href="#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a>, then</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>is also an instance of <a class="reference internal" href="#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a>. To evaluate and get its value,
call <a class="reference internal" href="#chainer.utils.type_check.Expr.eval" title="chainer.utils.type_check.Expr.eval"><code class="xref py py-meth docutils literal"><span class="pre">eval()</span></code></a> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Call <code class="docutils literal"><span class="pre">str</span></code> function to get a representation of the original
equation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">&#39;x == y&#39;</span>
</pre></div>
</div>
<p>You can actually compare an expression with a value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Note that you can’t use boolean operators such as <code class="docutils literal"><span class="pre">and</span></code>, as they try
to cast expressions to boolean values:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="n">z</span>  <span class="c1"># raises an error</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">RuntimeError</span>: <span class="n">Don&#39;t convert Expr to bool. Please call Expr.eval method to evaluate expression.</span>
</pre></div>
</div>
</div>
<dl class="method">
<dt id="chainer.utils.type_check.Expr.eval">
<code class="descname">eval</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/utils/type_check.html#Expr.eval"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.utils.type_check.Expr.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluates the tree to get actual value.</p>
<p>Behavior of this function depends on an implementation class.
For example, a binary operator <code class="docutils literal"><span class="pre">+</span></code> calls the <code class="docutils literal"><span class="pre">__add__</span></code> function
with the two results of <a class="reference internal" href="#chainer.utils.type_check.Expr.eval" title="chainer.utils.type_check.Expr.eval"><code class="xref py py-meth docutils literal"><span class="pre">eval()</span></code></a> function.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="chainer.utils.type_check.expect">
<code class="descclassname">chainer.utils.type_check.</code><code class="descname">expect</code><span class="sig-paren">(</span><em>*bool_exprs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/utils/type_check.html#expect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.utils.type_check.expect" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluates and tests all given expressions.</p>
<p>This function evaluates given boolean expressions in order. When at least
one expression is evaluated as <code class="docutils literal"><span class="pre">False</span></code>, that means the given condition is
not satisfied.
You can check conditions with this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bool_exprs</strong> (<em>tuple of Bool expressions</em>) – Bool expressions you want to
evaluate.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="chainer.utils.type_check.TypeInfo">
<em class="property">class </em><code class="descclassname">chainer.utils.type_check.</code><code class="descname">TypeInfo</code><span class="sig-paren">(</span><em>shape</em>, <em>dtype</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/utils/type_check.html#TypeInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.utils.type_check.TypeInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Type information of an input/gradient array.</p>
<p>It contains type information of an array, such as the shape of array and
the number of dimensions.
This information is independent of CPU or GPU array.</p>
</dd></dl>

<dl class="class">
<dt id="chainer.utils.type_check.TypeInfoTuple">
<em class="property">class </em><code class="descclassname">chainer.utils.type_check.</code><code class="descname">TypeInfoTuple</code><a class="reference internal" href="../_modules/chainer/utils/type_check.html#TypeInfoTuple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.utils.type_check.TypeInfoTuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Type information of input/gradient tuples.</p>
<p>It is a sub-class of tuple containing <a class="reference internal" href="#chainer.utils.type_check.TypeInfo" title="chainer.utils.type_check.TypeInfo"><code class="xref py py-class docutils literal"><span class="pre">TypeInfo</span></code></a>. The i-th element
of this object contains type information of the i-th input/gradient data.
As each element is <a class="reference internal" href="#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr"><code class="xref py py-class docutils literal"><span class="pre">Expr</span></code></a>, you can easily check its validity.</p>
<dl class="method">
<dt id="chainer.utils.type_check.TypeInfoTuple.size">
<code class="descname">size</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/utils/type_check.html#TypeInfoTuple.size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.utils.type_check.TypeInfoTuple.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an expression representing its length.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An expression object representing length of the tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#chainer.utils.type_check.Expr" title="chainer.utils.type_check.Expr">Expr</a></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="gradient-checking-utilities">
<h2>Gradient checking utilities<a class="headerlink" href="#gradient-checking-utilities" title="Permalink to this headline">¶</a></h2>
<p>Most function implementations are numerically tested by <em>gradient checking</em>.
This method computes numerical gradients of forward routines and compares their results with the corresponding backward routines.
It enables us to make the source of issues clear when we hit an error of gradient computations.
The <a class="reference internal" href="#module-chainer.gradient_check" title="chainer.gradient_check"><code class="xref py py-mod docutils literal"><span class="pre">chainer.gradient_check</span></code></a> module makes it easy to implement the gradient checking.</p>
<span class="target" id="module-chainer.gradient_check"></span><dl class="function">
<dt id="chainer.gradient_check.check_backward">
<code class="descclassname">chainer.gradient_check.</code><code class="descname">check_backward</code><span class="sig-paren">(</span><em>func</em>, <em>x_data</em>, <em>y_grad</em>, <em>params=()</em>, <em>eps=0.001</em>, <em>atol=1e-05</em>, <em>rtol=0.0001</em>, <em>no_grads=None</em>, <em>dtype=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/gradient_check.html#check_backward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.gradient_check.check_backward" title="Permalink to this definition">¶</a></dt>
<dd><p>Test backward procedure of a given function.</p>
<p>This function automatically check backward-process of given function.
For example, when you have a <a class="reference internal" href="core/function.html#chainer.Function" title="chainer.Function"><code class="xref py py-class docutils literal"><span class="pre">Function</span></code></a> class <code class="docutils literal"><span class="pre">MyFunc</span></code>,
that gets two arguments and returns one value, you can make its test like
this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="k">def</span> <span class="nf">test_my_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="o">&gt;&gt;</span>   <span class="n">func</span> <span class="o">=</span> <span class="n">MyFunc</span><span class="p">()</span>
<span class="o">&gt;&gt;</span>   <span class="n">x1_data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">&gt;&gt;</span>   <span class="n">x2_data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">&gt;&gt;</span>   <span class="n">gy_data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">&gt;&gt;</span>   <span class="n">check_backward</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="n">x1_data</span><span class="p">,</span> <span class="n">x2_data</span><span class="p">),</span> <span class="n">gy_data</span><span class="p">)</span>
</pre></div>
</div>
<p>This method creates <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> objects with <code class="docutils literal"><span class="pre">x_data</span></code>
and calls <code class="docutils literal"><span class="pre">func</span></code> with the <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> s to get its result
as <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a>.
Then, it sets <code class="docutils literal"><span class="pre">y_grad</span></code> array to <code class="docutils literal"><span class="pre">grad</span></code> attribute of the result and
calls <code class="docutils literal"><span class="pre">backward</span></code> method to get gradients of the inputs.
To check correctness of the gradients, the function calls
<a class="reference internal" href="#chainer.gradient_check.numerical_grad" title="chainer.gradient_check.numerical_grad"><code class="xref py py-func docutils literal"><span class="pre">numerical_grad()</span></code></a> to calculate numerically the gradients and compares
the types of gradients with <a class="reference internal" href="#chainer.testing.assert_allclose" title="chainer.testing.assert_allclose"><code class="xref py py-func docutils literal"><span class="pre">chainer.testing.assert_allclose()</span></code></a>.
If input objects (<code class="docutils literal"><span class="pre">x1_data</span></code> or/and <code class="docutils literal"><span class="pre">x2_data</span></code> in this example) represent
integer variables, their gradients are ignored.</p>
<p>You can simplify a test when <code class="docutils literal"><span class="pre">MyFunc</span></code> gets only one argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span>   <span class="n">check_backward</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x1_data</span><span class="p">,</span> <span class="n">gy_data</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">MyFunc</span></code> is a loss function which returns a zero-dimensional
array, pass <code class="docutils literal"><span class="pre">None</span></code> to <code class="docutils literal"><span class="pre">gy_data</span></code>. In this case, it sets <code class="docutils literal"><span class="pre">1</span></code> to
<code class="docutils literal"><span class="pre">grad</span></code> attribute of the result:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span>   <span class="n">check_backward</span><span class="p">(</span><span class="n">my_loss_func</span><span class="p">,</span> <span class="p">(</span><span class="n">x1_data</span><span class="p">,</span> <span class="n">x2_data</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">MyFunc</span></code> returns multiple outputs, pass all gradients for outputs
as a tuple:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span>   <span class="n">gy1_data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">&gt;&gt;</span>   <span class="n">gy2_data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">&gt;&gt;</span>   <span class="n">check_backward</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x1_data</span><span class="p">,</span> <span class="p">(</span><span class="n">gy1_data</span><span class="p">,</span> <span class="n">gy2_data</span><span class="p">))</span>
</pre></div>
</div>
<p>You can also test a <a class="reference internal" href="core/link.html#chainer.Link" title="chainer.Link"><code class="xref py py-class docutils literal"><span class="pre">Link</span></code></a>.
To check gradients of parameters of the link, set a tuple of the parameters
to <code class="docutils literal"><span class="pre">params</span></code> arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span>   <span class="n">check_backward</span><span class="p">(</span><span class="n">my_link</span><span class="p">,</span> <span class="p">(</span><span class="n">x1_data</span><span class="p">,</span> <span class="n">x2_data</span><span class="p">),</span> <span class="n">gy_data</span><span class="p">,</span>
<span class="o">&gt;&gt;</span>                  <span class="p">(</span><span class="n">my_link</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">my_link</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">params</span></code> are not <code class="docutils literal"><span class="pre">ndarray</span></code> s,
but <code class="xref py py-class docutils literal"><span class="pre">Variables</span></code> s.</p>
<p>Function objects are acceptable as <code class="docutils literal"><span class="pre">func</span></code> argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span>   <span class="n">check_backward</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span>
<span class="o">&gt;&gt;</span>                  <span class="p">(</span><span class="n">x1_data</span><span class="p">,</span> <span class="n">x2_data</span><span class="p">),</span> <span class="n">gy_data</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">func</span></code> is called many times to get numerical gradients for all inputs.
This function doesn’t work correctly when <code class="docutils literal"><span class="pre">func</span></code> behaves randomly as
it gets different gradients.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>func</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.6)"><em>callable</em></a>) – A function which gets <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> s
and returns <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> s. <code class="docutils literal"><span class="pre">func</span></code> must returns
a tuple of <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> s or one
<a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a>. You can use <a class="reference internal" href="core/function.html#chainer.Function" title="chainer.Function"><code class="xref py py-class docutils literal"><span class="pre">Function</span></code></a>
object, <a class="reference internal" href="core/link.html#chainer.Link" title="chainer.Link"><code class="xref py py-class docutils literal"><span class="pre">Link</span></code></a> object or a function satisfying the
condition.</li>
<li><strong>x_data</strong> (<em>ndarray</em><em> or </em><em>tuple of ndarrays</em>) – A set of <code class="docutils literal"><span class="pre">ndarray</span></code> s to be
passed to <code class="docutils literal"><span class="pre">func</span></code>. If <code class="docutils literal"><span class="pre">x_data</span></code> is one <code class="docutils literal"><span class="pre">ndarray</span></code> object, it is
treated as <code class="docutils literal"><span class="pre">(x_data,)</span></code>.</li>
<li><strong>y_grad</strong> (<em>ndarray</em><em> or </em><em>tuple of ndarrays</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><em>None</em></a>) – A set of <code class="docutils literal"><span class="pre">ndarray</span></code> s representing gradients of return-values of
<code class="docutils literal"><span class="pre">func</span></code>. If <code class="docutils literal"><span class="pre">y_grad</span></code> is one <code class="docutils literal"><span class="pre">ndarray</span></code> object, it is
treated as <code class="docutils literal"><span class="pre">(y_grad,)</span></code>. If <code class="docutils literal"><span class="pre">func</span></code> is a loss-function,
<code class="docutils literal"><span class="pre">y_grad</span></code> should be set to <code class="docutils literal"><span class="pre">None</span></code>.</li>
<li><strong>params</strong> (<a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><em>Variable</em></a><em> or </em><em>tuple of ~chainder.Variable</em>) – A set of <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> s whose gradients are checked.
When <code class="docutils literal"><span class="pre">func</span></code> is a <a class="reference internal" href="core/link.html#chainer.Link" title="chainer.Link"><code class="xref py py-class docutils literal"><span class="pre">Link</span></code></a> object,
set its parameters as <code class="docutils literal"><span class="pre">params</span></code>.
If <code class="docutils literal"><span class="pre">params</span></code> is one <a class="reference internal" href="core/variable.html#chainer.Variable" title="chainer.Variable"><code class="xref py py-class docutils literal"><span class="pre">Variable</span></code></a> object,
it is treated as <code class="docutils literal"><span class="pre">(params,)</span></code>.</li>
<li><strong>eps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – Epsilon value to be passed to <a class="reference internal" href="#chainer.gradient_check.numerical_grad" title="chainer.gradient_check.numerical_grad"><code class="xref py py-func docutils literal"><span class="pre">numerical_grad()</span></code></a>.</li>
<li><strong>atol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – Absolute tolerance to be passed to
<a class="reference internal" href="#chainer.testing.assert_allclose" title="chainer.testing.assert_allclose"><code class="xref py py-func docutils literal"><span class="pre">chainer.testing.assert_allclose()</span></code></a>.</li>
<li><strong>rtol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – Relative tolerance to be passed to
<a class="reference internal" href="#chainer.testing.assert_allclose" title="chainer.testing.assert_allclose"><code class="xref py py-func docutils literal"><span class="pre">chainer.testing.assert_allclose()</span></code></a>.</li>
<li><strong>no_grads</strong> (<em>list of bool</em>) – Flag to skip variable for gradient assertion.
It should be same length as <code class="docutils literal"><span class="pre">x_data</span></code>.</li>
<li><strong>dtype</strong> (<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.dtype.html#numpy.dtype" title="(in NumPy v1.13)"><em>dtype</em></a>) – <code class="docutils literal"><span class="pre">x_data</span></code> and <code class="docutils literal"><span class="pre">y_grad</span></code> are casted to this
dtype when calculating numerical gradients. Only float types and
<code class="docutils literal"><span class="pre">None</span></code> are allowed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>See:</dt>
<dd><a class="reference internal" href="#chainer.gradient_check.numerical_grad" title="chainer.gradient_check.numerical_grad"><code class="xref py py-func docutils literal"><span class="pre">numerical_grad()</span></code></a></dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="chainer.gradient_check.numerical_grad">
<code class="descclassname">chainer.gradient_check.</code><code class="descname">numerical_grad</code><span class="sig-paren">(</span><em>f</em>, <em>inputs</em>, <em>grad_outputs</em>, <em>eps=0.001</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/gradient_check.html#numerical_grad"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.gradient_check.numerical_grad" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes numerical gradient by finite differences.</p>
<p>This function is used to implement gradient check. For usage example, see
unit tests of <a class="reference internal" href="functions.html#module-chainer.functions" title="chainer.functions"><code class="xref py py-mod docutils literal"><span class="pre">chainer.functions</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>f</strong> (<a class="reference internal" href="function_hooks.html#module-chainer.function" title="chainer.function"><em>function</em></a>) – Python function with no arguments that runs forward
computation and returns the result.</li>
<li><strong>inputs</strong> (<em>tuple of arrays</em>) – Tuple of arrays that should be treated as
inputs. Each element of them is slightly modified to realize
numerical gradient by finite differences.</li>
<li><strong>grad_outputs</strong> (<em>tuple of arrays</em>) – Tuple of arrays that are treated as
output gradients.</li>
<li><strong>eps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – Epsilon value of finite differences.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Numerical gradient arrays corresponding to <code class="docutils literal"><span class="pre">inputs</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)">tuple</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="standard-assertions">
<h2>Standard Assertions<a class="headerlink" href="#standard-assertions" title="Permalink to this headline">¶</a></h2>
<p>The assertions have same names as NumPy’s ones.
The difference from NumPy is that they can accept both <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.13)"><code class="xref py py-class docutils literal"><span class="pre">numpy.ndarray</span></code></a>
and <code class="xref py py-class docutils literal"><span class="pre">cupy.ndarray</span></code>.</p>
<span class="target" id="module-chainer.testing"></span><dl class="function">
<dt id="chainer.testing.assert_allclose">
<code class="descclassname">chainer.testing.</code><code class="descname">assert_allclose</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>atol=1e-05</em>, <em>rtol=0.0001</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/testing/array.html#assert_allclose"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.testing.assert_allclose" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts if some corresponding element of x and y differs too much.</p>
<p>This function can handle both CPU and GPU arrays simultaneously.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>x</strong> – Left-hand-side array.</li>
<li><strong>y</strong> – Right-hand-side array.</li>
<li><strong>atol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – Absolute tolerance.</li>
<li><strong>rtol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – Relative tolerance.</li>
<li><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.6)"><em>bool</em></a>) – If <code class="docutils literal"><span class="pre">True</span></code>, it outputs verbose messages on error.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="function-testing-utilities">
<h2>Function testing utilities<a class="headerlink" href="#function-testing-utilities" title="Permalink to this headline">¶</a></h2>
<p>Chainer provides some utilities for testing its functions.</p>
<span class="target" id="module-chainer.testing"></span><dl class="function">
<dt id="chainer.testing.unary_math_function_unittest">
<code class="descclassname">chainer.testing.</code><code class="descname">unary_math_function_unittest</code><span class="sig-paren">(</span><em>func</em>, <em>func_expected=None</em>, <em>label_expected=None</em>, <em>make_data=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/chainer/testing/unary_math_function_test.html#unary_math_function_unittest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chainer.testing.unary_math_function_unittest" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator for testing unary mathematical Chainer functions.</p>
<p>This decorator makes test classes test unary mathematical Chainer
functions. Tested are forward and backward computations on CPU and GPU
across parameterized <code class="docutils literal"><span class="pre">shape</span></code> and <code class="docutils literal"><span class="pre">dtype</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>func</strong> (<a class="reference internal" href="core/function.html#chainer.Function" title="chainer.Function"><em>Function</em></a>) – Chainer function to be tested by the decorated
test class.</li>
<li><strong>func_expected</strong> – Function used to provide expected values for
testing forward computation. If not given, a corresponsing numpy
function for <code class="docutils literal"><span class="pre">func</span></code> is implicitly picked up by its class name.</li>
<li><strong>label_expected</strong> (<a class="reference external" href="https://docs.python.org/3/library/string.html#module-string" title="(in Python v3.6)"><em>string</em></a>) – String used to test labels of Chainer
functions. If not given, the class name of <code class="docutils literal"><span class="pre">func</span></code> lowered is
implicitly used.</li>
<li><strong>make_data</strong> – Function to customize input and gradient data used
in the tests. It takes <code class="docutils literal"><span class="pre">shape</span></code> and <code class="docutils literal"><span class="pre">dtype</span></code> as its arguments,
and returns a tuple of input and gradient data. By default, uniform
destribution ranged <code class="docutils literal"><span class="pre">[-1,</span> <span class="pre">1]</span></code> is used for both.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The decorated test class tests forward and backward computations on CPU and
GPU across the following <code class="xref py py-func docutils literal"><span class="pre">parameterize()</span></code> ed
parameters:</p>
<ul class="simple">
<li>shape: rank of zero, and rank of more than zero</li>
<li>dtype: <code class="docutils literal"><span class="pre">numpy.float16</span></code>, <code class="docutils literal"><span class="pre">numpy.float32</span></code> and <code class="docutils literal"><span class="pre">numpy.float64</span></code></li>
</ul>
<p>Additionally, it tests the label of the Chainer function.</p>
<p>Chainer functions tested by the test class decorated with the decorator
should have the following properties:</p>
<ul class="simple">
<li>Unary, taking one parameter and returning one value</li>
<li><code class="docutils literal"><span class="pre">dtype</span></code> of input and output are the same</li>
<li>Elementwise operation for the supplied ndarray</li>
</ul>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>The following code defines a test class that tests
<a class="reference internal" href="functions.html#chainer.functions.sin" title="chainer.functions.sin"><code class="xref py py-func docutils literal"><span class="pre">sin()</span></code></a> Chainer function, which takes a parameter
with <code class="docutils literal"><span class="pre">dtype</span></code> of float and returns a value with the same <code class="docutils literal"><span class="pre">dtype</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">chainer</span> <span class="k">import</span> <span class="n">testing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">chainer</span> <span class="k">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@testing</span><span class="o">.</span><span class="n">unary_math_function_unittest</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">Sin</span><span class="p">())</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">TestSin</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
<p>Because the test methods are implicitly injected to <code class="docutils literal"><span class="pre">TestSin</span></code> class by
the decorator, it is enough to place <code class="docutils literal"><span class="pre">pass</span></code> in the class definition.</p>
<p>Now the test is run with <code class="docutils literal"><span class="pre">nose</span></code> module.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nose</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nose</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">defaultTest</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;!gpu&#39;</span><span class="p">],</span> <span class="n">exit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>To customize test data, <code class="docutils literal"><span class="pre">make_data</span></code> optional parameter can be used.
The following is an example of testing <code class="docutils literal"><span class="pre">sqrt</span></code> Chainer function, which
is tested in positive value domain here instead of the default input.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">make_data</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">gy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">gy</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@testing</span><span class="o">.</span><span class="n">unary_math_function_unittest</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">(),</span>
<span class="gp">... </span>                                      <span class="n">make_data</span><span class="o">=</span><span class="n">make_data</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">TestSqrt</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nose</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">defaultTest</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;!gpu&#39;</span><span class="p">],</span> <span class="n">exit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p class="last"><code class="docutils literal"><span class="pre">make_data</span></code> function which returns input and gradient data generated
in proper value domains with given <code class="docutils literal"><span class="pre">shape</span></code> and <code class="docutils literal"><span class="pre">dtype</span></code> parameters is
defined, then passed to the decorator’s <code class="docutils literal"><span class="pre">make_data</span></code> parameter.</p>
</div>
</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="functions.html" class="btn btn-neutral float-right" title="Standard Function implementations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="util/experimental.html" class="btn btn-neutral" title="Experimental feature annotation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Preferred Networks, inc. and Preferred Infrastructure, inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.0.0b1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>